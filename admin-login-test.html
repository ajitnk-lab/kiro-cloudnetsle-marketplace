<!DOCTYPE html>
<html>
<head>
    <title>Admin Login Test</title>
    <script src="https://unpkg.com/aws-amplify@5.3.11/dist/aws-amplify.min.js"></script>
</head>
<body>
    <h1>Admin Login Test</h1>
    <div>
        <input type="email" id="email" placeholder="Email" value="ajitnk2006+admin@gmail.com">
        <input type="password" id="password" placeholder="Password" value="AdminPass123!">
        <button onclick="testLogin()">Login</button>
    </div>
    <div id="result"></div>

    <script>
        const { Amplify, Auth } = window.aws_amplify_core;
        
        Amplify.configure({
            Auth: {
                Cognito: {
                    userPoolId: 'us-east-1_5EpprbR5R',
                    userPoolClientId: '58u72aor8kf4f93pf93pdnqecu',
                    identityPoolId: undefined,
                    loginWith: { email: true },
                    signUpVerificationMethod: 'code',
                    userAttributes: { email: { required: true } },
                    allowGuestAccess: false,
                    passwordFormat: {
                        minLength: 8,
                        requireLowercase: true,
                        requireUppercase: true,
                        requireNumbers: true,
                        requireSpecialCharacters: true,
                    },
                }
            }
        });

        async function testLogin() {
            const result = document.getElementById('result');
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            try {
                result.innerHTML = '<p>Attempting login...</p>';
                
                const signInResult = await Auth.signIn({ username: email, password });
                result.innerHTML += '<p>✅ Login successful</p>';
                
                const session = await Auth.fetchAuthSession();
                const idToken = session.tokens?.idToken;
                const accessToken = session.tokens?.accessToken;
                
                if (idToken) {
                    const payload = idToken.payload;
                    result.innerHTML += `<p>User: ${payload.email}</p>`;
                    result.innerHTML += `<p>Role: ${payload['custom:role']}</p>`;
                    result.innerHTML += `<p>ID Token: ${idToken.toString().substring(0, 50)}...</p>`;
                    
                    // Test API call with ID token
                    const response = await fetch('https://1d98dlxxhh.execute-api.us-east-1.amazonaws.com/prod/admin/solutions', {
                        headers: {
                            'Authorization': `Bearer ${idToken.toString()}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    result.innerHTML += `<p>API Call: ${response.status}</p>`;
                    
                    if (response.ok) {
                        const data = await response.json();
                        result.innerHTML += `<p>Solutions: ${JSON.stringify(data).substring(0, 200)}...</p>`;
                    } else {
                        const error = await response.text();
                        result.innerHTML += `<p>Error: ${error}</p>`;
                    }
                }
                
            } catch (error) {
                result.innerHTML += `<p>❌ Error: ${error.message}</p>`;
                console.error('Login error:', error);
            }
        }
    </script>
</body>
</html>
