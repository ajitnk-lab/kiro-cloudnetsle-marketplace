"use strict";
// Add this after the existing payment functions in api-stack.ts
// Cashfree Subscription Webhook Function
const cashfreeSubscriptionWebhookFunction = new lambda.Function(this, 'CashfreeSubscriptionWebhookFunction', {
    runtime: lambda.Runtime.NODEJS_18_X,
    handler: 'cashfree-subscription-webhook.handler',
    code: lambda.Code.fromAsset('lambda/payments'),
    environment: {
        USER_SOLUTION_ENTITLEMENTS_TABLE: props.userSolutionEntitlementsTable.tableName,
        SUBSCRIPTIONS_TABLE: 'marketplace-subscriptions',
        USER_TABLE: props.userTable.tableName,
    },
    role: lambdaRole,
    timeout: cdk.Duration.seconds(30),
});
// Add this in the API routes section after the existing webhook routes:
// Cashfree subscription webhook route (no auth required)
const webhooksResource = this.api.root.addResource('api').addResource('webhooks');
const cashfreeResource = webhooksResource.addResource('cashfree');
cashfreeResource.addResource('subscription').addMethod('POST', new apigateway.LambdaIntegration(cashfreeSubscriptionWebhookFunction), {
    authorizationType: apigateway.AuthorizationType.NONE
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBpLXN0YWNrLWFkZGl0aW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXBpLXN0YWNrLWFkZGl0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxnRUFBZ0U7QUFFNUQseUNBQXlDO0FBQ3pDLE1BQU0sbUNBQW1DLEdBQUcsSUFBSSxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxxQ0FBcUMsRUFBRTtJQUMzRyxPQUFPLEVBQUUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxXQUFXO0lBQ25DLE9BQU8sRUFBRSx1Q0FBdUM7SUFDaEQsSUFBSSxFQUFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLGlCQUFpQixDQUFDO0lBQzlDLFdBQVcsRUFBRTtRQUNYLGdDQUFnQyxFQUFFLEtBQUssQ0FBQyw2QkFBNkIsQ0FBQyxTQUFTO1FBQy9FLG1CQUFtQixFQUFFLDJCQUEyQjtRQUNoRCxVQUFVLEVBQUUsS0FBSyxDQUFDLFNBQVMsQ0FBQyxTQUFTO0tBQ3RDO0lBQ0QsSUFBSSxFQUFFLFVBQVU7SUFDaEIsT0FBTyxFQUFFLEdBQUcsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQztDQUNsQyxDQUFDLENBQUE7QUFFTix3RUFBd0U7QUFFcEUseURBQXlEO0FBQ3pELE1BQU0sZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsQ0FBQTtBQUNqRixNQUFNLGdCQUFnQixHQUFHLGdCQUFnQixDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsQ0FBQTtBQUNqRSxnQkFBZ0IsQ0FBQyxXQUFXLENBQUMsY0FBYyxDQUFDLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxJQUFJLFVBQVUsQ0FBQyxpQkFBaUIsQ0FBQyxtQ0FBbUMsQ0FBQyxFQUFFO0lBQ3BJLGlCQUFpQixFQUFFLFVBQVUsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJO0NBQ3JELENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIEFkZCB0aGlzIGFmdGVyIHRoZSBleGlzdGluZyBwYXltZW50IGZ1bmN0aW9ucyBpbiBhcGktc3RhY2sudHNcblxuICAgIC8vIENhc2hmcmVlIFN1YnNjcmlwdGlvbiBXZWJob29rIEZ1bmN0aW9uXG4gICAgY29uc3QgY2FzaGZyZWVTdWJzY3JpcHRpb25XZWJob29rRnVuY3Rpb24gPSBuZXcgbGFtYmRhLkZ1bmN0aW9uKHRoaXMsICdDYXNoZnJlZVN1YnNjcmlwdGlvbldlYmhvb2tGdW5jdGlvbicsIHtcbiAgICAgIHJ1bnRpbWU6IGxhbWJkYS5SdW50aW1lLk5PREVKU18xOF9YLFxuICAgICAgaGFuZGxlcjogJ2Nhc2hmcmVlLXN1YnNjcmlwdGlvbi13ZWJob29rLmhhbmRsZXInLFxuICAgICAgY29kZTogbGFtYmRhLkNvZGUuZnJvbUFzc2V0KCdsYW1iZGEvcGF5bWVudHMnKSxcbiAgICAgIGVudmlyb25tZW50OiB7XG4gICAgICAgIFVTRVJfU09MVVRJT05fRU5USVRMRU1FTlRTX1RBQkxFOiBwcm9wcy51c2VyU29sdXRpb25FbnRpdGxlbWVudHNUYWJsZS50YWJsZU5hbWUsXG4gICAgICAgIFNVQlNDUklQVElPTlNfVEFCTEU6ICdtYXJrZXRwbGFjZS1zdWJzY3JpcHRpb25zJyxcbiAgICAgICAgVVNFUl9UQUJMRTogcHJvcHMudXNlclRhYmxlLnRhYmxlTmFtZSxcbiAgICAgIH0sXG4gICAgICByb2xlOiBsYW1iZGFSb2xlLFxuICAgICAgdGltZW91dDogY2RrLkR1cmF0aW9uLnNlY29uZHMoMzApLFxuICAgIH0pXG5cbi8vIEFkZCB0aGlzIGluIHRoZSBBUEkgcm91dGVzIHNlY3Rpb24gYWZ0ZXIgdGhlIGV4aXN0aW5nIHdlYmhvb2sgcm91dGVzOlxuXG4gICAgLy8gQ2FzaGZyZWUgc3Vic2NyaXB0aW9uIHdlYmhvb2sgcm91dGUgKG5vIGF1dGggcmVxdWlyZWQpXG4gICAgY29uc3Qgd2ViaG9va3NSZXNvdXJjZSA9IHRoaXMuYXBpLnJvb3QuYWRkUmVzb3VyY2UoJ2FwaScpLmFkZFJlc291cmNlKCd3ZWJob29rcycpXG4gICAgY29uc3QgY2FzaGZyZWVSZXNvdXJjZSA9IHdlYmhvb2tzUmVzb3VyY2UuYWRkUmVzb3VyY2UoJ2Nhc2hmcmVlJylcbiAgICBjYXNoZnJlZVJlc291cmNlLmFkZFJlc291cmNlKCdzdWJzY3JpcHRpb24nKS5hZGRNZXRob2QoJ1BPU1QnLCBuZXcgYXBpZ2F0ZXdheS5MYW1iZGFJbnRlZ3JhdGlvbihjYXNoZnJlZVN1YnNjcmlwdGlvbldlYmhvb2tGdW5jdGlvbiksIHtcbiAgICAgIGF1dGhvcml6YXRpb25UeXBlOiBhcGlnYXRld2F5LkF1dGhvcml6YXRpb25UeXBlLk5PTkVcbiAgICB9KVxuIl19